"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2631],{2631:(I,T,c)=>{c.r(T),c.d(T,{AccountPageModule:()=>L});var _=c(9808),p=c(4182),i=c(7110),y=c(1143),g=c(655),e=c(9863),O=c(591),f=c(4872),P=c(1228),s=c(5593);let d=(()=>{class n{constructor(t,o){this.authService=t,this.apiService=o,this._profile=new O.X(null)}get profile(){return this._profile.asObservable()}getProfile(){return(0,g.mG)(this,void 0,void 0,function*(){try{const t=yield this.authService.getId();let o;const r=yield this.apiService.getDocById(`users/${t}`);if(!(null==r?void 0:r.exists()))throw"No such document exists";o=r.data(),console.log("profile: ",o);const a=new f.n(o.email,o.phone,o.name,t,o.type,o.status);return this._profile.next(a),a}catch(t){throw t}})}updateProfile(t,o){return(0,g.mG)(this,void 0,void 0,function*(){try{const r=yield this.authService.getId(),A=(yield this.apiService.updateDocument(`users/${r}`,o),new f.n(o.email,o.phone,t.name,t.uid,t.type,t.status));return this._profile.next(A),A}catch(r){throw console.log(r),r}})}updateProfileWithEmail(t,o,r){return(0,g.mG)(this,void 0,void 0,function*(){try{return yield this.authService.updateEmail(t.email,o.email,r),yield this.updateProfile(t,o),t}catch(a){throw a}})}}return n.\u0275fac=function(t){return new(t||n)(e.LFG(P.e),e.LFG(s.s))},n.\u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();var m=c(7020);const b=["phoneInput"];function u(n,l){1&n&&e._UZ(0,"ion-icon",16)}function v(n,l){1&n&&e._UZ(0,"ion-icon",16)}function S(n,l){if(1&n&&(e.TgZ(0,"ion-button",17),e._uU(1,"UPDATE"),e.qZA()),2&n){e.oxw();const t=e.MAs(6);e.Q6J("disabled",!t.valid)}}function Z(n,l){if(1&n&&(e.TgZ(0,"ion-button",18),e._UZ(1,"ion-spinner",19),e.qZA()),2&n){e.oxw();const t=e.MAs(6);e.Q6J("disabled",!t.valid)}}let h=(()=>{class n{constructor(t,o){this.profileService=t,this.global=o,this.isSubmitted=!1}ngOnInit(){setTimeout(()=>{this.phoneInput.setFocus(),console.log("enter")},500)}onSubmit(t){return(0,g.mG)(this,void 0,void 0,function*(){try{if(!t.valid)return;console.log(t.value),this.isSubmitted=!0,this.profile.email!=t.value.email?this.presentPasswordPrompt(t.value):(yield this.profileService.updateProfile(this.profile,t.value),this.global.modalDismiss()),this.isSubmitted=!1}catch(o){console.log(o),this.isSubmitted=!1,this.global.errorToast()}})}presentPasswordPrompt(t){this.global.showAlert("Please enter your password to change YOur Email Address","Verify",[{text:"Cancel",role:"cancel",handler:()=>{console.log("Confirm Cancel")}},{text:"Verify",handler:o=>{console.log(o.password),""!=o.password.trim()&&o.password.length>=8?this.updateEmail(t,o.password):this.global.errorToast("Password must be of atleast 8 characters")}}],[{name:"password",type:"password",placeholder:"Enter Password"}])}updateEmail(t,o){return(0,g.mG)(this,void 0,void 0,function*(){try{yield this.profileService.updateProfileWithEmail(this.profile,t,o),this.global.modalDismiss()}catch(r){console.log(r);let a="No Internet Connection";("auth/email-already-in-use"==r.code||"auth/wrong-password"==r.code)&&(a=r.message),this.global.errorToast(a)}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d),e.Y36(m.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-edit-profile"]],viewQuery:function(t,o){if(1&t&&e.Gf(b,5),2&t){let r;e.iGM(r=e.CRH())&&(o.phoneInput=r.first)}},inputs:{profile:"profile"},decls:24,vars:6,consts:[[1,"ion-no-border"],["mode","ios"],["color","dark"],[3,"ngSubmit"],["f","ngForm"],[1,"ion-padding-horizontal","ion-margin-bottom"],[1,"ion-margin-vertical"],["position","floating"],["type","tel","minlength","10","maxlength","10","required","","name","phone",3,"ngModel"],["phoneInput","","phone","ngModel"],["name","checkmark-outline","slot","end","color","primary",4,"ngIf"],["type","email","required","","name","email",3,"ngModel"],["email","ngModel"],[1,"ion-padding-horizontal","ion-text-center"],["expand","block","type","submit","color","primary",3,"disabled",4,"ngIf"],["color","primary",3,"disabled",4,"ngIf"],["name","checkmark-outline","slot","end","color","primary"],["expand","block","type","submit","color","primary",3,"disabled"],["color","primary",3,"disabled"],["name","crescent"]],template:function(t,o){if(1&t){const r=e.EpF();e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title",2),e._uU(3,"EDIT ACCOUNT"),e.qZA()()(),e.TgZ(4,"ion-content")(5,"form",3,4),e.NdJ("ngSubmit",function(){e.CHM(r);const A=e.MAs(6);return o.onSubmit(A)}),e.TgZ(7,"ion-list",5)(8,"ion-item",6)(9,"ion-label",7),e._uU(10,"PHONE NUMBER"),e.qZA(),e._UZ(11,"ion-input",8,9),e.YNc(14,u,1,0,"ion-icon",10),e.qZA(),e.TgZ(15,"ion-item")(16,"ion-label",7),e._uU(17,"EMAIL ADDRESS"),e.qZA(),e._UZ(18,"ion-input",11,12),e.YNc(20,v,1,0,"ion-icon",10),e.qZA()(),e.TgZ(21,"div",13),e.YNc(22,S,2,1,"ion-button",14),e.YNc(23,Z,2,1,"ion-button",15),e.qZA()()()}if(2&t){const r=e.MAs(13),a=e.MAs(19);e.xp6(11),e.Q6J("ngModel",null==o.profile?null:o.profile.phone),e.xp6(3),e.Q6J("ngIf",r.valid),e.xp6(4),e.Q6J("ngModel",null==o.profile?null:o.profile.email),e.xp6(2),e.Q6J("ngIf",a.valid),e.xp6(2),e.Q6J("ngIf",!o.isSubmitted),e.xp6(1),e.Q6J("ngIf",o.isSubmitted)}},directives:[i.Gu,i.sr,i.wd,i.W2,p._Y,p.JL,p.F,i.q_,i.Ie,i.Q$,i.pK,i.j9,p.wO,p.nD,p.Q7,p.JJ,p.On,_.O5,i.gu,i.YG,i.PQ],styles:["ion-item[_ngcontent-%COMP%]{align-items:center}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.8rem!important;font-weight:400!important}"]}),n})();var C=c(1332),x=c(4267),w=c(1479);function M(n,l){if(1&n&&(e.TgZ(0,"ion-text",11)(1,"p"),e._uU(2),e.qZA()()),2&n){const t=l.$implicit;e.xp6(2),e.AsE("",null==t?null:t.name," x ",null==t?null:t.quantity,"")}}let U=(()=>{class n{constructor(){this.reorder=new e.vpe,this.help=new e.vpe}ngOnInit(){}reorderItem(){this.reorder.emit(this.order)}getHelp(){this.help.emit(this.order)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-orders"]],inputs:{order:"order"},outputs:{reorder:"reorder",help:"help"},decls:25,vars:6,consts:[[1,"borderBottom"],["lines","none",1,"dashedBorderBottom"],["name","chevron-forward-outline"],["slot","end","color","dark"],["name","checkmark-circle-outline","color","success"],["lines","none"],["color","dark",4,"ngFor","ngForOf"],[1,"time"],["size","6"],["fill","outline","expand","block","color","primary",3,"click"],["fill","outline","expand","block","color","dark",3,"click"],["color","dark"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-item-group",0)(1,"ion-item",1)(2,"ion-label"),e._uU(3),e.TgZ(4,"p"),e._uU(5),e.qZA(),e.TgZ(6,"ion-text")(7,"p"),e._uU(8),e._UZ(9,"ion-icon",2),e.qZA()()(),e.TgZ(10,"ion-note",3),e._uU(11),e._UZ(12,"ion-icon",4),e.qZA()(),e.TgZ(13,"ion-item",5)(14,"ion-label"),e.YNc(15,M,3,2,"ion-text",6),e.TgZ(16,"p",7),e._uU(17),e.qZA(),e.TgZ(18,"ion-row")(19,"ion-col",8)(20,"ion-button",9),e.NdJ("click",function(){return o.reorderItem()}),e._uU(21,"REORDER"),e.qZA()(),e.TgZ(22,"ion-col",8)(23,"ion-button",10),e.NdJ("click",function(){return o.getHelp()}),e._uU(24,"GET HELP"),e.qZA()()()()()()),2&t&&(e.xp6(3),e.hij(" ",null==o.order||null==o.order.restaurant?null:o.order.restaurant.name," "),e.xp6(2),e.Oqu(null==o.order||null==o.order.restaurant?null:o.order.restaurant.address),e.xp6(3),e.hij(" CHF ",null==o.order?null:o.order.grandTotal," "),e.xp6(3),e.hij(" ",null==o.order?null:o.order.status," "),e.xp6(4),e.Q6J("ngForOf",null==o.order?null:o.order.order),e.xp6(2),e.Oqu(null==o.order?null:o.order.time))},directives:[i.Ub,i.Ie,i.Q$,i.yW,i.gu,i.uN,_.sg,i.Nd,i.wI,i.YG],styles:[".time[_ngcontent-%COMP%]{margin-top:1vh}ion-label[_ngcontent-%COMP%]{font-size:.95rem}ion-label[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.6rem}ion-note[_ngcontent-%COMP%]{font-size:.87rem}ion-note[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{float:right;padding-left:.2rem}p[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})();function E(n,l){1&n&&(e.TgZ(0,"div",6),e._UZ(1,"ion-spinner",0),e.qZA())}function N(n,l){1&n&&(e.TgZ(0,"ion-text",15)(1,"p"),e._uU(2,"No Orders Placed Yet"),e.qZA()())}function J(n,l){if(1&n){const t=e.EpF();e.TgZ(0,"app-orders",16),e.NdJ("reorder",function(r){return e.CHM(t),e.oxw(2).reorder(r)})("help",function(r){return e.CHM(t),e.oxw(2).getHelp(r)}),e.qZA()}2&n&&e.Q6J("order",l.$implicit)}const Y=function(){return["/","tabs","address"]};function F(n,l){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-list",7)(2,"ion-item",8)(3,"ion-button",9),e.NdJ("click",function(){return e.CHM(t),e.oxw().editProfile()}),e._uU(4,"EDIT"),e.qZA(),e.TgZ(5,"ion-label")(6,"ion-text",10)(7,"h4"),e._uU(8),e.qZA()(),e.TgZ(9,"p"),e._uU(10),e.qZA()()(),e.TgZ(11,"ion-item",11),e._UZ(12,"ion-icon",12),e.TgZ(13,"h5"),e._uU(14,"Manage Addresses"),e.qZA()()(),e.TgZ(15,"ion-list")(16,"ion-list-header")(17,"ion-label",0),e._uU(18,"PAST ORDERS"),e.qZA()(),e.YNc(19,N,3,0,"ion-text",13),e.YNc(20,J,1,1,"app-orders",14),e.qZA(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(8),e.Oqu(null==t.profile?null:t.profile.name),e.xp6(2),e.AsE("",null==t.profile?null:t.profile.phone," | ",null==t.profile?null:t.profile.email,""),e.xp6(1),e.Q6J("routerLink",e.DdM(6,Y)),e.xp6(8),e.Q6J("ngIf",!t.orders||0==(null==t.orders?null:t.orders.length)),e.xp6(1),e.Q6J("ngForOf",t.orders)}}const Q=[{path:"",component:(()=>{class n{constructor(t,o,r,a,A,k){this.navCtrl=t,this.orderService=o,this.cartService=r,this.global=a,this.profileService=A,this.authService=k,this.profile={},this.orders=[]}ngOnInit(){this.ordersSub=this.orderService.orders.subscribe(t=>{console.log("order data: ",t),this.orders=t},t=>{console.log(t)}),this.profileSub=this.profileService.profile.subscribe(t=>{this.profile=t,console.log(this.profile)}),this.getData()}ionViewDidEnter(){console.log("ionViewDidEnter AccountPage"),this.global.customStatusbar(!0)}getData(){return(0,g.mG)(this,void 0,void 0,function*(){try{this.isLoading=!0,yield this.profileService.getProfile(),yield this.orderService.getOrders(),this.isLoading=!1}catch(t){this.isLoading=!1,console.log(t),this.global.errorToast()}})}confirmLogout(){this.global.showAlert("Are you sure you want to sign-out?","Confirm",[{text:"No",role:"cancel"},{text:"Yes",handler:()=>{this.logout()}}])}logout(){this.global.showLoader(),this.authService.logout().then(()=>{this.navCtrl.navigateRoot(C.e.LOGIN),this.global.hideLoader()}).catch(t=>{console.log(t),this.global.hideLoader(),this.global.errorToast("Logout Failed! Check your internet connection")})}reorder(t){return(0,g.mG)(this,void 0,void 0,function*(){console.log(t);let o=yield this.cartService.getCart();console.log("data: ",o),(null==o?void 0:o.value)?this.cartService.alertClearCart(null,null,null,t):this.cartService.orderToCart(t)})}getHelp(t){console.log(t)}editProfile(){return(0,g.mG)(this,void 0,void 0,function*(){const t={component:h,componentProps:{profile:this.profile},swipeToClose:!0,breakpoints:[0,.5,.8],initialBreakpoint:.8};yield this.global.createModal(t)})}ionViewDidLeave(){console.log("ionViewDidLeave AccountPage"),this.global.customStatusbar()}ngOnDestroy(){this.ordersSub&&this.ordersSub.unsubscribe(),this.profileSub&&this.profileSub.unsubscribe(),this.orderService.reset()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(i.SH),e.Y36(x.p),e.Y36(w.N),e.Y36(m.U),e.Y36(d),e.Y36(P.e))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-account"]],decls:10,vars:2,consts:[["color","primary"],["slot","end"],["fill","clear",3,"click"],["name","power-outline","color","white","slot","icon-only"],["class","ion-text-center alignSpinner",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","alignSpinner"],[1,"borderBottom"],["lines","full"],["slot","end","fill","clear",3,"click"],[1,"ion-text-uppercase"],["lines","none","detail","true",3,"routerLink"],["name","home-outline","slot","start","color","dark"],["class","ion-text-center",4,"ngIf"],[3,"order","reorder","help",4,"ngFor","ngForOf"],[1,"ion-text-center"],[3,"order","reorder","help"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-title"),e._uU(3,"My Account"),e.qZA(),e.TgZ(4,"ion-buttons",1)(5,"ion-button",2),e.NdJ("click",function(){return o.confirmLogout()}),e._UZ(6,"ion-icon",3),e.qZA()()()(),e.TgZ(7,"ion-content"),e.YNc(8,E,2,0,"div",4),e.YNc(9,F,21,7,"ng-container",5),e.qZA()),2&t&&(e.xp6(8),e.Q6J("ngIf",o.isLoading),e.xp6(1),e.Q6J("ngIf",!o.isLoading))},directives:[i.Gu,i.sr,i.wd,i.Sm,i.YG,i.gu,i.W2,_.O5,i.PQ,i.q_,i.Ie,i.Q$,i.yW,i.YI,y.rH,i.yh,_.sg,U],styles:["p[_ngcontent-%COMP%]{font-size:.8rem}"]}),n})()}];let G=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[y.Bz.forChild(Q)],y.Bz]}),n})(),L=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[_.ez,p.u5,i.Pc,G]]}),n})()},4267:(I,T,c)=>{c.d(T,{p:()=>O});var _=c(655),p=c(591);class i{constructor(P,s,d,m,b,u,v,S,Z,h,C,x,w,M){this.address=P,this.restaurant=s,this.user=d,this.restaurant_id=m,this.order=b,this.total=u,this.grandTotal=v,this.deliveryCharge=S,this.status=Z,this.time=h,this.paid=C,this.id=x,this.uid=w,this.instruction=M}}var y=c(9863),g=c(1228),e=c(5593);let O=(()=>{class f{constructor(s,d){this.auth=s,this.api=d,this._orders=new p.X([])}get orders(){return this._orders.asObservable()}getRadius(){return this.api.radius}getUid(){return(0,_.mG)(this,void 0,void 0,function*(){return this.uid?this.uid:yield this.auth.getId()})}getOrders(){return(0,_.mG)(this,void 0,void 0,function*(){try{this.uid=yield this.getUid();const s=this.api.whereQuery("uid","==",this.uid),m=yield(yield this.api.getDocs("orders",s)).docs.map(b=>{let u=b.data();return u.id=b.id,u.order=JSON.parse(u.order),this.api.getDocByReference(u.restaurant).then(v=>{if(!(null==v?void 0:v.exists()))throw"No restaurant document exists";u.restaurant=v.data()}),u});return console.log("orders",m),this._orders.next(m),m}catch(s){throw s}})}placeOrder(s){return(0,_.mG)(this,void 0,void 0,function*(){try{const d=yield this.getUid(),m=JSON.stringify(s.order),b=this.api.document(`restaurants/${s.restaurant_id}`),u=this.api.document(`users/${d}`),v=Object.assign(Object.assign({},s),{address:Object.assign({},s.address),order:m,restaurant:b,uid:d,user:u}),Z=yield(yield this.api.addDocument("orders",v)).id;console.log("latest order: ",s);let h=[];return h.push(new i(s.address,s.restaurant,u,s.restaurant_id,s.order,s.total,s.grandTotal,s.deliveryCharge,s.status,s.time,s.paid,Z,d,s.instruction)),console.log("latest order: ",h),h=h.concat(this._orders.value),console.log("orders: ",h),this._orders.next(h),h}catch(d){throw d}})}reset(){this.uid=null}}return f.\u0275fac=function(s){return new(s||f)(y.LFG(g.e),y.LFG(e.s))},f.\u0275prov=y.Yz7({token:f,factory:f.\u0275fac,providedIn:"root"}),f})()}}]);