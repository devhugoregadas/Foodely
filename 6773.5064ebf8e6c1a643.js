"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6773],{6773:(O,h,l)=>{l.r(h),l.d(h,{EditAddressPageModule:()=>U});var g=l(9808),r=l(4182),s=l(7110),m=l(1143),c=l(655),f=l(7123),t=l(9863),v=l(7172),_=l(7020),u=l(9514),y=l(2875);const A=["map"];let M=(()=>{class i{constructor(o,e,n){this.maps=o,this.renderer=e,this.locationService=n,this.update=!1,this.center={lat:46.2167,lng:6.0833},this.location=new t.vpe}ngOnInit(){}ngAfterViewInit(){return(0,c.mG)(this,void 0,void 0,function*(){yield this.initMap(),this.mapChange=this.maps.markerChange.subscribe(o=>(0,c.mG)(this,void 0,void 0,function*(){if(null==o?void 0:o.lat){console.log("loc: ",o),console.log("maps: ",this.googleMaps);const n=new this.googleMaps.LatLng(o.lat,o.lng);this.map.panTo(n),this.marker.setMap(null),yield this.addMarker(n)}}))})}initMap(){return(0,c.mG)(this,void 0,void 0,function*(){try{if(this.update)yield this.loadMap();else{const o=yield this.locationService.getCurrentLocation();this.center={lat:o.coords.latitude,lng:o.coords.longitude},yield this.loadMap(),this.getAddress(this.center.lat,this.center.lng)}}catch(o){console.log(o),this.center={lat:46.2167,lng:6.0833},console.log(this.center),this.loadMap(),this.getAddress(this.center.lat,this.center.lng)}})}loadMap(){return(0,c.mG)(this,void 0,void 0,function*(){try{let e=yield this.maps.loadGoogleMaps();this.googleMaps=e;const n=[{featureType:"all",elementType:"all",stylers:[{saturation:-100}]}],d=this.mapElementRef.nativeElement,p=new e.LatLng(this.center.lat,this.center.lng);this.map=new e.Map(d,{center:p,zoom:15,scaleControl:!1,streetViewControl:!1,zoomControl:!1,overviewMapControl:!1,mapTypeControl:!1,mapTypeControlOptions:{mapTypeIds:[e.MapTypeId.ROADMAP,"Foodely"]}});var o=new e.StyledMapType(n,{name:"Grayscale"});this.map.mapTypes.set("Foodely",o),this.map.setMapTypeId("Foodely"),this.renderer.addClass(d,"visible"),this.addMarker(p)}catch(e){console.log(e)}})}addMarker(o){let e=this.googleMaps;const n={url:"assets/icons/location-pin.png",scaledSize:new e.Size(50,50)};this.marker=new e.Marker({position:o,map:this.map,icon:n,draggable:!0,animation:e.Animation.DROP}),this.mapListener=this.googleMaps.event.addListener(this.marker,"dragend",()=>{console.log("markerchange"),this.getAddress(this.marker.position.lat(),this.marker.position.lng())})}getAddress(o,e){return(0,c.mG)(this,void 0,void 0,function*(){try{const n=yield this.maps.getAddress(o,e);console.log(n);const d={title:n.address_components[0].short_name,address:n.formatted_address,lat:o,lng:e};console.log(d),this.location.emit(d)}catch(n){console.log(n)}})}ngOnDestroy(){this.mapListener&&this.googleMaps.event.removeListener(this.mapListener),this.mapChange&&this.mapChange.unsubscribe()}}return i.\u0275fac=function(o){return new(o||i)(t.Y36(u.t),t.Y36(t.Qsj),t.Y36(y.a))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-map"]],viewQuery:function(o,e){if(1&o&&t.Gf(A,7),2&o){let n;t.iGM(n=t.CRH())&&(e.mapElementRef=n.first)}},inputs:{update:"update",center:"center"},outputs:{location:"location"},decls:2,vars:0,consts:[[1,"map"],["map",""]],template:function(o,e){1&o&&t._UZ(0,"div",0,1)},styles:[".map[_ngcontent-%COMP%]{position:absolute;height:30vh;width:100%;background-color:transparent;opacity:0;transition:opacity .15s ease-in}.map.visible[_ngcontent-%COMP%]{opacity:1}"]}),i})();function b(i,a){1&i&&(t.TgZ(0,"div",7),t._UZ(1,"ion-spinner",8),t.qZA())}function C(i,a){if(1&i){const o=t.EpF();t.TgZ(0,"div",9)(1,"app-map",10),t.NdJ("location",function(n){return t.CHM(o),t.oxw().fetchLocation(n)}),t.qZA()()}if(2&i){const o=t.oxw();t.xp6(1),t.Q6J("center",o.center)("update",o.update)}}function x(i,a){1&i&&t._UZ(0,"ion-icon",26)}function k(i,a){1&i&&t._UZ(0,"ion-icon",26)}function P(i,a){1&i&&t._UZ(0,"ion-icon",26)}function Z(i,a){if(1&i){const o=t.EpF();t.TgZ(0,"ion-button",27),t.NdJ("click",function(){return t.CHM(o),t.oxw(2).onSubmit()}),t._uU(1,"SAVE & PROCEED "),t.qZA()}if(2&i){const o=t.oxw(2);t.Q6J("disabled",!(null!=o.form&&o.form.valid))}}function T(i,a){1&i&&(t.TgZ(0,"ion-button",28),t._UZ(1,"ion-spinner",29),t.qZA())}function E(i,a){if(1&i){const o=t.EpF();t.TgZ(0,"form",11)(1,"ion-list")(2,"ion-item",12),t._UZ(3,"ion-icon",13),t.TgZ(4,"ion-label"),t._uU(5),t.qZA(),t.TgZ(6,"ion-button",14),t.NdJ("click",function(){return t.CHM(o),t.oxw().searchLocation()}),t.TgZ(7,"span"),t._uU(8,"CHANGE"),t.qZA()()(),t.TgZ(9,"ion-row",15)(10,"ion-note",16),t._uU(11),t.qZA()(),t.TgZ(12,"ion-item-group",17)(13,"ion-item")(14,"ion-label",18)(15,"span"),t._uU(16,"HOUSE / FLAT / BLOCK NO."),t.qZA()(),t._UZ(17,"ion-input",19),t.YNc(18,x,1,0,"ion-icon",20),t.qZA(),t.TgZ(19,"ion-item")(20,"ion-label",18)(21,"span"),t._uU(22,"LANDMARK"),t.qZA()(),t._UZ(23,"ion-input",21),t.YNc(24,k,1,0,"ion-icon",20),t.qZA(),t.TgZ(25,"ion-item")(26,"ion-label",18)(27,"span"),t._uU(28,"SAVE AS"),t.qZA()(),t._UZ(29,"ion-input",22),t.YNc(30,P,1,0,"ion-icon",20),t.qZA()()(),t.TgZ(31,"div",23),t.YNc(32,Z,2,1,"ion-button",24),t.YNc(33,T,2,0,"ion-button",25),t.qZA()()}if(2&i){const o=t.oxw();t.Q6J("formGroup",o.form),t.xp6(5),t.Oqu(null==o.location?null:o.location.title),t.xp6(6),t.hij(" ",null==o.location?null:o.location.address," "),t.xp6(7),t.Q6J("ngIf",o.form.get("house").valid),t.xp6(6),t.Q6J("ngIf",o.form.get("landmark").valid),t.xp6(6),t.Q6J("ngIf",o.form.get("title").valid),t.xp6(2),t.Q6J("ngIf",!o.isSubmitted),t.xp6(1),t.Q6J("ngIf",o.isSubmitted)}}const L=[{path:"",component:(()=>{class i{constructor(o,e,n,d,p){this.navCtrl=o,this.addressService=e,this.global=n,this.maps=d,this.route=p,this.isSubmitted=!1,this.location={},this.isLoading=!1,this.check=!1}ngOnInit(){this.checkForUpdate()}checkForUpdate(){return(0,c.mG)(this,void 0,void 0,function*(){this.isLoading=!0,this.location.title="Locating...",this.isLocationFetched=!1;const o=this.route.snapshot.queryParams;if(console.log("data: ",o),null==o?void 0:o.data){const e=JSON.parse(o.data);(null==e?void 0:e.lat)&&(this.center={lat:e.lat,lng:e.lng},this.update=!0,this.location.lat=this.center.lat,this.location.lng=this.center.lng,this.location.address=e.address,this.location.title=e.title,(null==e?void 0:e.uid)&&(this.uid=e.uid),(null==e?void 0:e.from)||(this.id=e.id)),e.from&&(this.from=e.from),yield this.initForm(e),this.toggleFetched()}else this.update=!1,this.initForm()})}initForm(o){let e={title:null,house:null,landmark:null};o&&(e={title:o.title,house:o.house,landmark:o.landmark}),this.formData(e)}formData(o){this.form=new r.cw({title:new r.NI(o.title,{validators:[r.kI.required]}),house:new r.NI(o.house,{validators:[r.kI.required]}),landmark:new r.NI(o.landmark,{validators:[r.kI.required]})}),this.isLoading=!1}fetchLocation(o){this.location=o,console.log("location: ",this.location),this.isLocationFetched=!0}toggleFetched(){this.isLocationFetched=!this.isLocationFetched}toggleSubmit(){this.isSubmitted=!this.isSubmitted}onSubmit(){return(0,c.mG)(this,void 0,void 0,function*(){try{if(this.toggleSubmit(),console.log(this.form),!this.form.valid||!this.isLocationFetched)return void this.toggleSubmit();const o={title:this.form.value.title,landmark:this.form.value.landmark,house:this.form.value.house,address:this.location.address,lat:this.location.lat,lng:this.location.lng};console.log("address: ",o),this.id?yield this.addressService.updateAddress(this.id,o,this.uid):yield this.addressService.addAddress(o),this.check=!0,this.navCtrl.back(),this.toggleSubmit()}catch(o){console.log(o),this.isSubmitted=!1,this.global.errorToast()}})}searchLocation(){return(0,c.mG)(this,void 0,void 0,function*(){try{const o={component:f.t,cssClass:"address-modal",swipeToClose:!0,breakpoints:[0,.5,.7,.9],initialBreakpoint:.7},e=yield this.global.createModal(o);if(console.log("location: ",e),e){this.location=e;const n={lat:e.lat,lng:e.lng};this.update=!0,this.maps.changeMarkerInMap(n)}}catch(o){console.log(o)}})}ionViewDidLeave(){console.log("ionViewDidLeave EditAddressPage"),"home"==this.from&&!this.check&&this.addressService.changeAddress({})}}return i.\u0275fac=function(o){return new(o||i)(t.Y36(s.SH),t.Y36(v.D),t.Y36(_.U),t.Y36(u.t),t.Y36(m.gz))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-edit-address"]],decls:7,vars:3,consts:[["fullscreen","true"],["slot","fixed"],["slot","start","mode","md"],["defaultHref","/tabs/address","color","dark"],["class","ion-text-center alignSpinner",4,"ngIf"],["class","map",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"ion-text-center","alignSpinner"],["color","primary"],[1,"map"],[3,"center","update","location"],[3,"formGroup"],["lines","none"],["name","location-outline","color","dark","slot","start"],["slot","end","size","small","color","light",3,"click"],[1,"ion-padding-horizontal","ion-text-justify"],[1,"ion-text-wrap","ion-padding-horizontal"],[1,"ion-padding"],["color","medium","position","floating"],["type","text","autocomplete","","autocorrect","","formControlName","house"],["name","checkmark-outline","slot","end","color","primary",4,"ngIf"],["type","text","autocomplete","","autocorrect","","formControlName","landmark"],["type","text","autocomplete","","autocorrect","","formControlName","title"],[1,"ion-padding-horizontal"],["expand","block","type","submit","color","primary",3,"disabled","click",4,"ngIf"],["expand","block","color","primary",4,"ngIf"],["name","checkmark-outline","slot","end","color","primary"],["expand","block","type","submit","color","primary",3,"disabled","click"],["expand","block","color","primary"],["name","crescent"]],template:function(o,e){1&o&&(t.TgZ(0,"ion-content",0)(1,"ion-toolbar",1)(2,"ion-buttons",2),t._UZ(3,"ion-back-button",3),t.qZA()(),t.YNc(4,b,2,0,"div",4),t.YNc(5,C,2,2,"div",5),t.YNc(6,E,34,8,"form",6),t.qZA()),2&o&&(t.xp6(4),t.Q6J("ngIf",e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading),t.xp6(1),t.Q6J("ngIf",!e.isLoading))},directives:[s.W2,s.sr,s.Sm,s.oU,s.cs,g.O5,s.PQ,M,r._Y,r.JL,r.sg,s.q_,s.Ie,s.gu,s.Q$,s.YG,s.Nd,s.uN,s.Ub,s.pK,s.j9,r.JJ,r.u],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: transparent;--ion-color-base: transparent !important}.map[_ngcontent-%COMP%]{height:30vh}ion-item[_ngcontent-%COMP%]{align-items:center}ion-item[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--ion-color-primary)}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:.8rem}"]}),i})()}];let S=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[m.Bz.forChild(L)],m.Bz]}),i})();var I=l(5642);let U=(()=>{class i{}return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[[g.ez,r.UX,s.Pc,S,I.K]]}),i})()}}]);